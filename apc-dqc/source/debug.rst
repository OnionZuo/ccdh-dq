.. rst-class:: nonmodule

==============
日志和调试
==============

任务日志
--------------

日志表
^^^^^^^^^^^^^^^^^
* 程序开始运行并读取完存储于元数据库的当前批次任务信息后，:ref:`log-table` 会为所有任务生成日志，任务状态为 ``READY``。
* 执行任务脚本时，当前任务状态会更新为 ``RUNNING``，同时任务开始时间更新为当前时间。
* 如果任务执行中出现错误，任务状态会更新为 ``FAILED``，任务校验结果会更新为 ``-1``；如果任务执行成功，任务状态会更新为 ``FINISHED``，任务校验结果会更新为 ``0`` (与预期结果一致) 或 ``1`` (与预期结果不一致)。同时任务结束时间更新为当前时间，运行时长更新为任务结束时间和任务开始时间的差值。

.. py:currentmodule:: utils

.. seealso::

    :ref:`utils-module` 中的 ``init_logtb`` 和 ``update_logtb`` 函数


日志文件
^^^^^^^^^^^^
程序运行过程中，会另外自动生成一份日志文件，文件以运行批次命名，默认存储于 ``项目目录/logs`` 路径下。日志文件中会记录每次程序执行的详细情况，

.. note::

    * 日志存储路径或名称可在 :ref:`utils-module` 中修改，对应 ``logfolder`` 和 ``logfile`` 变量。
    * 日志格式细节请参见 :ref:`utils-module` 中 ``get_logger`` 函数和 ``exception_logging`` 装饰器


通知邮件
^^^^^^^^^^^^
每次程序运行结束以后，会自动向配置的收件人发送整体运行情况邮件，通知所有任务执行情况并附执行日志。

.. seealso::

    :ref:`utils-module` 中的 ``send_email`` 函数


常见报错和原因
-------------------